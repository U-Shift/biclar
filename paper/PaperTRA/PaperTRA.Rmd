---
classoption: "runningheads"
title: "biclaR: Estimating the socio-environmental impacts of car substitution by bicycle and public transit using open tools"
shorttitle: "biclaR: SE impacts of car substitution by bicycle and public transit"

authors: 
  - name: "Rosa Félix"
    inst: "1"
    orcid: "0000-0002-5642-6006"
  - name: "Filipe Moura"
    inst: "1"
    orcid: "0000-0001-7749-8490"
  - name: "Robin Lovelace"
    inst: "2"
    orcid: "0000-0001-5679-6536"
# First names are abbreviated in the running head.
# If there are more than two authors, 'et al.' is used.
authorrunning: "R. Félix et al." 
institutes: 
  - name: "CERIS - Instituto Superior Técnico, University of Lisbon. Av Rovisco Pais 1049-001 Lisboa, Portugal"
    email: "rosamfelix@tecnico.ulisboa.pt"
  - name: "Institute for Transport Studies, University of Leeds. 34-40 University Rd, Leeds LS2 9JT, UK"

abstract: | 
  A high proportion of car trips can be replaced by a combination of public transit and cycling for the first-and-last mile. This paper estimates the potential for cycling combined with public transit (PT) as a substitute for car trips in the Lisbon metropolitan area and assesses its socio-environmental impacts using open data and open source tools.
  A decision support tool that facilitates the design and development of a metropolitan cycling network was developed (_biclaR_). The social and environmental impacts were assessed using the _HEAT for Cycling_ and the _HEAT as a Service_ tools. The impacts of shifting car trips to PT were also estimated and monetized.
  The results indicate that 20% of car trips could switch to the bicycle + PT combination. Shifting to cycling for the first-and-last mile stages can reduce annual CO~2~eq emissions from 6,000 tons/day, with benefits over 10 years of €230 million. For the PT leg, the transfer from car avoids of at least 8,500 tons of CO~2~eq emissions per year.
  This evidence can support policymakers to prioritize interventions that reduce the reliance on private motor vehicles.
keywords: 
  - Active transport
  - Intermodality
  - First and last mile
  - Health economic assessment
  - Environmental impacts
  - Open data and methods
bibliography: bibliography.bib
# Use csl when using default citation_package for Pandoc citeproc
csl: https://www.zotero.org/styles/springer-lecture-notes-in-computer-science
# citations with arabic numbers is prefered when using natbib
natbiboptions: numbers

header-includes:
  # - \usepackage[hidelinks]{hyperref} #this is to remove the annoying boxes. but how to make them blue?
  - \usepackage{booktabs}
  - \usepackage{siunitx}
  - \usepackage{hyperref}
  - \hypersetup{colorlinks = TRUE,  urlcolor = blue, linkcolor = blue, citecolor = blue}
   #Colours links instead of ugly boxes
  #Colour for external hyperlinks
  #Colour of internal links
  #Colour of citations

output:
  rticles::lncs_article:
    citation_package: default # or natbib DEFINE LATER
# output: word_document

urlcolor: blue
linkcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      out.extra = "")  # This forces knitr to label all figures.
library(dplyr)
```

# Introduction

<!-- **full paper**: 4-6 pages in length (typically up to 3,000 words). -->

Combining public transportation (PT) and cycling for the first and last mile in metropolitan areas can significantly replace private car trips.
This approach requires interventions and programs to make bicycling more appealing, and the resulting public investments can have significant social and environmental benefits.

According to the latest mobility survey conducted in 2018 [@IMOB], the LMA registered a total of 5.3 million daily trips, with only 0.5% by bicycle.
Car modal share was 58.4%, while PT accounted for 15.5%.
The number of intra-municipal trips --- with origin and destination in the same municipality --- amounts to 3.5 million trips.
This exceeds the number of inter-municipal trips (1.8 million trips), involving travel between different municipalities.
Cars and public transport are the most used modes for intercity trips, with cars being the predominant choice for all journeys.

<!-- Plot of  AML trips by mode and inter/intra %? -->

To achieve the cycling targets set by the Portuguese national cycling strategy for 2025 and 2030 (4% and 10%, respectively) [@ENMAC], the Lisbon's Metropolitan Department of Transport introduced *biclaR*[^1], a decision support tool that facilitates the design and development of a metropolitan cycling network [@felix2023].

[^1]: See [biclar.tmlmobilidade.pt](https://biclar.tmlmobilidade.pt/).

*biclaR* builds on the Propensity to Cycle Tool[^2] (PCT), a web application and research project funded by the UK's Department for Transport in 2015 which launched nationally in 2017 as part of the government's Cycling and Walking Investment Strategy.
The PCT initially used only origin-destination data for commuting trips as the basis of estimates of cycling potential at zone, route and route network levels [@lovelace2017].
The PCT has been extended to include cycling potential for travel to school in England [@goodman2019] and other trip types in other countries.[^3]
However, to the best of our knowledge, this is the first time that the method has been integrated with public transport data using multi-modal routing to estimate the potential and benefits of multi-stage cycling and PT trips.

[^2]: See [pct.bike](https://www.pct.bike/).

[^3]:  See [npt.scot](https://www.npt.scot) and [cruse.bike](https://cruse.bike) for examples of the PCT in Scotland and Ireland that include estimates of cycling for other purposes.

This paper estimates the potential for combining cycling and PT to substitute car trips in the LMA.
After presenting the methods used, it assesses its socio-environmental impacts using open data and open-source tools.

# Methods

## Modeling Origin-Destination trips

The mobility survey data [@IMOB] is the basis for this project and defines the baseline scenario.
Despite being conducted in the pre-pandemic period (2017), this dataset represents the most comprehensive and up-to-date information on urban mobility in Portuguese metropolitan areas (Lisbon and Porto).

We used a method for disaggregating the origins and destinations of trips between the centroids of two districts (same as "parish") to ensure that a district is not solely characterized by a single point of origin and destination for its trips.
Aggregating all trips into centroids renders the exercise less realistic, as it excludes a significant portion of short-distance trips, a prevalent characteristic of active mode travel [@Lovelace2022Jittering].
The OD Jittering method breaks down a single point (i.e., the centroid of an area) into multiple random points on the existing and neighboring road network, using OpenStreetMap as a reference.
This method then distributes the volume of trips within the district among the randomly generated origin-destination pairs.

Using the [`odjitter` R package](https://github.com/dabreegster/odjitter), we employed a maximum disaggregation level of 100 trips per O-D pair for this project.
Figure \ref{fig:jitter} illustrates the contrast between trip representation through the traditional method, which connects a single desire line between each district, and the presentation achieved through the randomization and disaggregation of trips between districts, specifically for the Lisbon metropolitan area.

```{r jitter, fig.align='center', fig.cap="Representation of OD pairs in the Lisbon metropolitan area between districts, without jittering (left) and with jittering (right).", out.width="100%"}

# od_all = readRDS("paper/paperTRA/load/od_all.Rds")
# od_jittered_filter = readRDS("paper/paperTRA/load/od_jittered_filter.Rds")
# 
# par(mfrow = c(1, 2))
# plot(od_all$geometry, lwd = 0.1)
# plot(od_jittered_filter$geometry, lwd = 0.1)

knitr::include_graphics("img/jitter.png", error = FALSE)

```

Although this method provides a more realistic representation of the trips undertaken compared to the traditional approach, it does not fully align with the actual O-D pairs of trips, which remain unknown due to data privacy regulations.

## Modeling routes

The mobility survey collects the origin and destination of trips but does not include the respective routes.
Modeling the realistic cycling + PT routes between OD pairs depends on assumptions regarding the characteristics of the cycling and road networks and the location of public transport interfaces.
Other constraints regarding the behavior of potential cyclists determine the routing results.
For example, such restrictions can favor low speed, low traffic streets, more direct routes, and less steep paths, among others, suitable for cycling.

<!-- When comparing ground-truth dataset from 67 count locations distributed throughout the city of Lisbon with differemt routing providers and options, @Lovelace2022exploring found that jittering and disaggregating OD data, combined with routing using low level of traffic stress (quieter) preferences resulted in the most accurate route networks. -->

The selected route choice algorithm was the [`r5r` R package](https://ipeagit.github.io/r5r/) [@r5r], which allows for great flexibility in configuring estimated route types, and which proven to provide most accurate route networks for the city of Lisbon [@Lovelace2022exploring].
`r5r` can calculate multi-modal routes using PT combined with other modes.
It enables the identification of the most direct or safest cycling routes, using the Level of Traffic Stress[^4] (LTS) scale, ranging from 1 to 4, where 1 corresponds to the quietest (e.g., off-road cycle paths) and 4 corresponds to the least quiet (e.g., routes shared with motorized traffic).
The routes were estimated for the base scenario for both types of networks: *direct* and *safe*, using LTS 4 and LTS 3, respectively.

[^4]: see [docs.conveyal.com/learn-more/traffic-stress](https://docs.conveyal.com/learn-more/traffic-stress).

<!-- The quietness level^[see https://www.cyclestreets.net/help/journey/howitworks/#quietness] was another indicator estimated by [CycleStreets](https://www.cyclestreets.org/) for each route section, based on road network variables xisting on OpenStreetMap labels, such as the number of lanes, maximum allowed speed, trees, or road hierarchy. Values vary on a scale of 0 to 100, where zero corresponds to the least safe level for cycling and 100 corresponds to the safest and quietest level, usually corresponding to sections that already include segregated cycling infrastructure away from motorized traffic.  I THINK THIS IS NOT RELEVANT FOR THIS SHORT PAPER, AS IT IS MOST USEFUL FOR VIZUALIZATION PURPOSES ON BICLAR TOOL-->

The `r5r` model used the OpenStreetMap road network and the GTFS metropolitan data agregated and validated.
This information is crucial for an accurate PT trip and route estimation.
A digital elevation model from the European Space Agency's COPERNICUS mission, with a 25m spatial resolution, was used to include street gradient information, as a weight in cycling routing.
The cycling potential trips for the two national strategic targets (4% and 10%) was estimated from the values for cycling and car trips (both as a driver and as a passenger) from the 2017 base scenario.

The routes were then overlaid and aggregated by segments, using [`stplanr overline()` R function](https://docs.ropensci.org/stplanr/reference/overline.html).
<!-- For example, the estimated volumes of bicycle trips and car transfers were aggregated, and the average car speed and quietness level, weighted by the distance of the segments, were calculated. -->

## Modeling intermodality

The intermodality scenario considers trips combining PT and cycling for the first and last legs.
In a conservative approach, we have restricted our analysis to the first and last legs with a combined length of up to 5 km (for instance: 1 km from origin to interface A plus 4 km from interface B to destination) or up to 25 minutes on bike.
Furthermore, we have imposed restrictions on PT usage to include only trips with no PT transfers, and up to 2 hours (120 min).
Additionally, we have only included PT modes that can easily accommodate bicycles, such as trains, ferries, trams, and inter-municipal bus lines equipped with bike racks (Figure \ref{fig:map1}).

```{r map1, out.width="60%", fig.cap="Interfaces and lines considered, by transport mode, in the Lisbon metropolitan area", fig.align='center'}
knitr::include_graphics("img/map1.png", error = FALSE)
```

Figure \ref{fig:map2} illustrates the resulting bicycle routes to access the main PT interfaces in the LMA.

```{r map2, out.width="80%", fig.cap="Bike routes with highest potential to serve as first and last leg when replacing cycling and PT from car trips (screenshot of the interactive online tool).", fig.align='center'}
knitr::include_graphics("img/map2.png", error = FALSE)
```

## Assessing socio-environmental benefits

<!-- The impacts were assessed for the total metro area. -->

For the cycling legs of the journey (first and last legs), socio-environmental impacts were estimated, using the HEAT for Cycling tool v5.0 [@HEAT] and the [`HEATaaS` R package](https://github.com/HEAT-WHO/HEAT_heatr_api)[^5] from the World Health Organization.
The HEAT tool provided estimates on the shifting from car to cycling for a short term time horizon (i.e., one year) and the long term (i.e., ten years).
We considered two dimensions: *social* — including the physical activity of cyclists, air pollution exposure, and road casualties; *environmental* — including CO~2~eq emissions and other pollutants. 

[^5]: `HEATaaS` is under development. For more information contact [heatwalkingcycling.org](https://heatwalkingcycling.org).

<!-- For the full paper, consider refer the input HEAT values (tabela 6) -->
<!-- Explain why the use of the HaaS tool instead of the website (3 scenarios, 18 municipalities, 2 routing profiles) -->
<!-- Also consider put the FE formula and emmission factor values - see report -->

For the second leg of the journey, we estimate the additional environmental impacts of shifting car trips to PT (between the PT interfaces).

To estimate the car emissions, we used the EMEP/EEA's COPERT software v5 methods and reference values [@COPERT] for a Tier 3 detail level. 
We used a family-size vehicle, EURO standard, and gasoline or diesel fuel.
All trips were considered to be made under urban conditions and at an average speed of 15 km/h during rush hour periods.
Since the average distance traveled per trip influences the overconsumption and emissions from cold-start engine operation, we estimated energy and emission factors for different ranges of trips at 500-meter intervals.
In addition, we assumed an occupancy rate of 1.61 passengers *per* car [@IMOB].

Regarding the PT, we considered the emission factor values reported in the environmental and sustainability reports of the PT operators in the LMA [@Carris2019s; @Metro2019s; @CP2019s; @Transtejo2014].

Emissions were estimated for the following atmospheric pollutants: CO~2~eq, CO, PM10, NOx, and VOC.
In particular, for the urban train and tram -- with 100% electric traction -- only CO~2~eq emissions were considered (resulting from the production of electricity, considering a "well-to-tank" approach), since the other pollutants are not emitted locally.

The conversion of avoided emissions into avoided welfare loss and respective monetary valuation was based on the EU Guide to Cost-benefit Analysis [@EuropeanCommission2014] and the best up-to-date reference values for the various gases [@EuropeanCommission2014; @bickel2006; @UNITE].
The social impacts are in avoided premature mortality. This result is finally monetized using the *Statistical Value of Life* for Portugal [@ANSR2021].
We updated all the monetary reference values of the literature based on the annual inflation rate in Portugal for 2022[^6], and our 10-years estimations assumed a with a discount rate of 5% and inflation of 3%. 

[^6]: See [Statistics Portugal tool for inflation rate estimates between years](https://www.ine.pt/xportal/xmain?xpid=INE&xpgid=ipc).

<!-- For the environmental impacts, using conversion values by the ton, suggested by Bickel et al. (2006), Nash et al. (2003), Sartori et al. (2014) : 8.44 €/ton for CO, 2,867.85 €/ton for NOX, 340,969.27 €/ton for PM10, 7,169.62 €/ton for VOC and 35.85 €/ton for CO2eq. -->

# Results and Discussion

Table \ref{tab:summary1} presents the LMA total daily trips, the cycling combined with PT trips in the baseline scenario and corresponding new trips to achieve the national strategy targets (4% and 10%), for different route profiles. 
For the cycling legs of the journey (first and last legs), the environmental avoided emmissions and monetized socio-environment benefits are also presented, resulting from replacing car trips with cycling.

For both *direct* and *safe* route profiles, 20% of the daily car trips have the potential to be replaced by a combination of PT and cycling (up to 5 km on bike). 
<!-- place in the end - here is not clear -->

```{r summary1old, eval=FALSE, out.width="100%", fig.cap="Summary of the cycling potencial of intermodality scenario."}
knitr::include_graphics("img/table1.png", error = FALSE)
```
```{r summary1}
summary1 = readRDS("load/summary1.Rds")

summary1 = summary1 %>%
  mutate(LTS = recode(LTS, `3` = "safe", `4` = "direct")) |> 
  mutate(Estrategia = paste0(Estrategia*100,"%"))

knitr::kable(summary1,
      digits = 0,
      format.args = list(big.mark = " "),
      col.names = c("Target", "Routing", "Total trips",
                    "Baseline Cycling + PT", "Potencial Cycling + PT",
                    "Avoided CO2eq (ton/yr)", "SE Benefits for 10 years (thousand €)"),
      caption = "\\label{summary1}Summary of the cycling potencial of intermodality scenario.",
      format="latex",
      booktabs = TRUE) |> 
  kableExtra::column_spec(column = c(4:7), width = "6em")
  # kableExtra::kable_styling(full_width = TRUE)
  

```

This scenario unveils the potential of bicycles as a complementary mode of PT, with the potential to uptake the number of PT trips within the LMA area by as much as 12% (in addition to the 825,000 reported in the mobility survey).
These findings indicate that transferring car trips to a combination of bicycle and PT could be nearly as substantial, if not equally significant, as the shift towards bicycle-only trips.

A valorização monetária das emissões (em toneladas) é apresentada na tabela seguinte, para o cenário 3 (apenas a segunda parte da viagem, em transportes públicos), com as metas de 4% e 10%, e usando as redes cicláveis "direta" e "segura", para 365 dias (1 ano).

<!-- this co2 needs to be added to the second table and then discuss -->
We estimate a reduction of 8,702 tons of CO2eq emissions by substituting motorized trips relying on fossil fuels and electricity. These estimations used an electricity production life cycle approach.

impactes ambientais de transferência do automóvel para os transportes públicos (tabela 5), para além dos impactes ambientais e sociais da transferência para a bicicleta (tabela 4)

Table \ref{tab:summary21} shows something that doesn't make sense.
<!-- ???? -->

```{r summary2old, eval=FALSE, out.width="100%", fig.cap="Potencial de transferência estimado para cada modo de transporte público, bem como as estimativas de consumo de CO~2~eq evitado anualmente por transferência do automóvel."}
knitr::include_graphics("img/table2.png", error = FALSE)
```

```{r summary21}
summary2 = readRDS("load/TPtable_aml.Rds")

summary21 = summary2 %>%
  mutate(LTS = recode(Percursos, "seguro" = "safe", "direto" = "direct")) |> 
  select(Meta_ENMAC, LTS, Total, BUS, FERRY, RAIL, TRAM)

knitr::kable(summary21,
      digits = 0,
      format.args = list(big.mark = " "),
      col.names = c("Target", "Routing", "Total",
                    "Bus", "Ferry", "Train", "Tram"),
      caption = "\\label{summary21}Summary of the potential of replacing car trips with cycling in combination with PT, disagregated by PT mode.",
      format="latex",
      booktabs = TRUE)
  # kableExtra::column_spec(column = c(4:7), width = "6em")
  # kableExtra::kable_styling(full_width = TRUE)
  
```

```{r summary22}

summary22 = summary2 %>%
  mutate(LTS = recode(Percursos, "seguro" = "safe", "direto" = "direct")) |> 
  select(Meta_ENMAC, LTS, CO2eq_TP, CO_PT, PM10_PT, NOx_PT, VOC_PT, money_emissions_eur)
```

<!-- Tipo de Percurso   Meta ENMAC  Total   Barco   Comboio Autocarro   Metro superfície    CO~2~eq CO  PM10    NOx VOC Valorização monetária (€) -->

<!-- seguro 4%  192 214 5 167   169 984 4 163   12 900  8 593   17  1.9 27  0.8 1 424 620 -->

<!-- seguro 10% 224 152 5 594   197 857 5 042   15 659  20 627  42  4.6 65  2.0 3 430 552 -->

<!-- direto 4%  189 846 5 795   171 534 4 879   7 639   8 702   18  2.0 28  0.8 1 452 820 -->

<!-- direto 10% 219 511 6 263   198 373 5 806   9 069   20 793  42  4.7 66  1.9 3 487 282 -->

Em suma, o impacte socioeconómico das emissões de gases poluentes e de gases de efeito estufa pode ser valorizado numa poupança potencial de entre 1.4 a 3.5 milhões €, a acrescentar aos impactes estimados na secção anterior.

The results indicate that 20% of the current trips can be made with the bicycle + PT combination, with an additional 12% of PT trips being potentially replaced.
Shifting to cycling for the first-and-last mile can reduce annual CO~2~eq emissions by 6,000 to 15,000 tons/day, and the 10-year socio-environmental benefits account for €230 to €590 million, depending on the cycling targets.
For the PT leg, the transfer from car results in the avoidance of 8,500 to 20,800 tons of CO~2~eq emissions per year, or €1.4 to €3.5 million over 10 years, with trains offering the greatest potential for substitution (88%).

The estimated socio-economic impacts stemming from the avoided pollutants and greenhouse gases vary from €1.4 million to €3.5 million. Our findings suggest that a bicycle and PT combination could viably replace 20% of current trips, with an additional 12% of PT journeys prone to further substitution. The adoption of cycling for first-and-last-mile travel can curtail annual CO2 equivalent emissions by 6,000 to 15,000 tons per day. Over a decade, the resulting socio-environmental benefits could accrue to an estimated range of €230 million to €590 million, contingent upon the targeted cycling modalities. Regarding the PT segment, the shift from private car usage would lead to the mitigation of CO2 equivalent emissions to 8,500 to 20,800 tons annually, translating to a monetary value of €1.4 million to €3.5 million over a decade. Trains exhibit the highest potential for substitution, accounting for 88% of this benefit.


# Conclusion

By making the research process publicly accessible in a code repository, this study enables the replication of similar estimates for socio-environmental impacts resulting from a modal shift from car to bicycle in combination with PT in other metropolitan areas.

The train with most potential (as seen from fig 2)

Different routing profiles for different city cycling maturity levels [@felix2017].

The information available at the open access website can be downloaded, and used with any GIS software to, for instance, understant which cycling connections have the highest socioenvironmental impacts, in tons of avoided CO2eq emissions, or in long term social costs.

The provided information on socio-economic benefits can support policymakers in prioritizing interventions to reduce the reliance on individual motorized transportation and better communicate their decisions.

### Acknowledgements {.unnumbered}

Thomas Götshi - HAAS.

# References {.unnumbered}